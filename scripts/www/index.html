<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ ç²¾é©¾åˆ° Â· ä¸»ç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #0a0c12;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        /* æ‰‹æœºå®¹å™¨ */
        .app-container {
            max-width: 450px;
            width: 100%;
            height: 100vh;
            background: #0a0c12;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            padding: 12px 20px 8px;
            display: flex;
            justify-content: space-between;
            color: #a2bbd9;
            font-size: 14px;
            font-weight: 500;
            background: rgba(10, 14, 23, 0.7);
            border-bottom: 1px solid #2f3a4b;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  - å…­å¤§ç‰ˆå—æ¨ªå‘æ’åˆ— */
        .top-nav {
            background: #10141c;
            border-bottom: 1px solid #2f3a4b;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .top-nav::-webkit-scrollbar {
            display: none;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .logo-icon {
            font-size: 24px;
            color: #ffcf8a;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 800;
            background: linear-gradient(135deg, #fff6d5, #ffd8aa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            white-space: nowrap;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            flex: 1;
            justify-content: flex-end;
        }

        .nav-link {
            color: #a2bbd9;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            white-space: nowrap;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .nav-link.active {
            color: #ffcf8a;
            background: rgba(255, 200, 100, 0.15);
            border: 1px solid rgba(255, 180, 70, 0.6);
        }

        /* ä¸»å†…å®¹åŒº - å¯æ»šåŠ¨ */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 16px 16px 10px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .content-area::-webkit-scrollbar {
            display: none;
        }

        /* é¦–é¡µå†…å®¹ */
        .home-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .hero-section {
            background: #10141c;
            border-radius: 28px;
            padding: 24px 20px;
            border: 1px solid #2f3a4b;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .pill-tag {
            display: inline-block;
            background: rgba(255, 200, 100, 0.15);
            border: 1px solid rgba(255, 180, 70, 0.6);
            border-radius: 60px;
            padding: 6px 16px;
            color: #ffcf8a;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .hero-title {
            font-size: 38px;
            font-weight: 800;
            line-height: 1.1;
            background: linear-gradient(135deg, #fff6d5, #ffd8aa, #ffc37b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 12px;
            text-shadow: 0 0 20px rgba(255, 165, 0, 0.3);
        }

        .hero-sub {
            color: #a2bbd9;
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .cta-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .cta-primary {
            background: linear-gradient(145deg, #fcc169, #fb9e2c);
            border: none;
            border-radius: 40px;
            padding: 14px 28px;
            font-size: 18px;
            font-weight: 700;
            color: #0e141f;
            cursor: pointer;
            border-bottom: 4px solid #b87c2a;
            flex: 1;
        }

        .cta-secondary {
            background: transparent;
            border: 2px solid #fcb26b;
            border-radius: 40px;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: 600;
            color: #ffcf8a;
            cursor: pointer;
            flex: 1;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: #1a1f2b;
            border: 1px solid #2f3a4b;
            border-radius: 24px;
            padding: 16px 12px;
            flex: 1;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffeac0, #ffc876);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.2;
        }

        .stat-label {
            color: #8da2c0;
            font-size: 13px;
            margin-top: 4px;
        }

        .stat-unit {
            color: #ffcf8a;
            font-size: 14px;
            margin-left: 4px;
        }

        /* ä¸‹æ–¹åŠŸèƒ½å¡ç‰‡åŒºåŸŸ - æŠ¬æ é—¯å…³å’Œè°¬è¯¯å‰§åœº */
        .bottom-features {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 8px;
        }

        .feature-card {
            background: #1a1f2b;
            border: 1px solid #2f3a4b;
            border-radius: 24px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 6px solid #fcb26b;
        }

        .feature-card:active {
            transform: scale(0.98);
            background: #252e3e;
            border-color: #ffb658;
        }

        .feature-icon {
            font-size: 48px;
            color: #ffcf8a;
        }

        .feature-info {
            flex: 1;
        }

        .feature-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffd8aa, #ffc37b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 4px;
        }

        .feature-desc {
            color: #a2bbd9;
            font-size: 14px;
        }

        .feature-badge {
            background: #fcb26b;
            color: #0e141f;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        /* å­é¡µé¢æ ·å¼ */
        .subpage {
            background: #10141c;
            border-radius: 28px;
            padding: 20px;
            border: 1px solid #2f3a4b;
            min-height: 70vh;
            margin-top: 8px;
        }

        .subpage-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .back-btn {
            background: #1a1f2b;
            border: none;
            border-radius: 40px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #b1c7e0;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            border-bottom: 3px solid #2f3a4b;
        }

        .subpage-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff6d5, #ffd8aa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* èŠå¤©/å‰§åœºç•Œé¢ */
        .chat-container {
            background: #1a1f2b;
            border-radius: 28px;
            padding: 16px;
            border: 1px solid #2f3a4b;
        }

        .chat-history {
            min-height: 350px;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 8px;
            margin-bottom: 16px;
        }

        .message {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .msg-avatar {
            font-size: 24px;
        }

        .msg-bubble {
            background: #10141c;
            padding: 12px 16px;
            border-radius: 22px;
            border: 1px solid #fcb26b;
            color: #e6e9f0;
            max-width: 80%;
            font-size: 14px;
            line-height: 1.5;
        }

        .message.user .msg-bubble {
            background: #1a1f2b;
            border-color: #ffb658;
            color: #fff0d5;
        }

        .chat-input-area {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            background: #10141c;
            border: 2px solid #fcb26b;
            border-radius: 40px;
            padding: 14px 18px;
            font-size: 15px;
            color: #e6e9f0;
            outline: none;
        }

        .chat-input::placeholder {
            color: #556b82;
        }

        .send-btn {
            background: linear-gradient(145deg, #fcc169, #fb9e2c);
            border: none;
            border-radius: 40px;
            padding: 0 24px;
            font-weight: bold;
            font-size: 16px;
            color: #0e141f;
            cursor: pointer;
            border-bottom: 4px solid #b87c2a;
        }

        /* è¯Šæ–­ç•Œé¢ */
        .diagnosis-container {
            background: #1a1f2b;
            border-radius: 28px;
            padding: 20px;
            border: 1px solid #2f3a4b;
        }

        .diagnosis-input {
            width: 100%;
            background: #10141c;
            border: 2px solid #fcb26b;
            border-radius: 24px;
            padding: 18px;
            font-size: 15px;
            color: #e6e9f0;
            min-height: 120px;
            margin-bottom: 16px;
            resize: none;
        }

        .diagnosis-result {
            background: #10141c;
            border-radius: 24px;
            padding: 18px;
            margin-top: 16px;
            border-left: 6px solid #fcb26b;
            font-size: 14px;
            line-height: 1.6;
            color: #b1c7e0;
        }

        /* é—¯å…³/è°œé¢˜ç•Œé¢ */
        .quiz-container {
            background: #1a1f2b;
            border-radius: 28px;
            padding: 20px;
            border: 1px solid #2f3a4b;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 18px;
            color: #b1c7e0;
        }

        .question-text {
            font-size: 20px;
            margin-bottom: 24px;
            color: #fff0d5;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .option-item {
            background: #10141c;
            border: 2px solid #fcb26b;
            border-radius: 40px;
            padding: 16px 20px;
            font-size: 16px;
            color: #b1c7e0;
            cursor: pointer;
        }

        .option-item.selected {
            background: #1a1f2b;
            border-color: #ffd700;
            box-shadow: 0 0 10px #fcb26b;
            color: #ffd78c;
        }

        .score-badge {
            font-size: 20px;
            background: #10141c;
            padding: 8px 18px;
            border-radius: 40px;
            border: 1px solid #fcb26b;
            color: #ffcf8a;
        }

        .quiz-btn {
            background: linear-gradient(145deg, #fcc169, #fb9e2c);
            border: none;
            border-radius: 40px;
            padding: 14px 24px;
            font-weight: bold;
            font-size: 16px;
            color: #0e141f;
            cursor: pointer;
            border-bottom: 4px solid #b87c2a;
        }

        .quiz-btn.secondary {
            background: #1a1f2b;
            color: #b1c7e0;
            border-bottom-color: #2f3a4b;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <span>9:41</span>
            <span>ğŸ“¶ ğŸ”‹ 100%</span>
        </div>

        <!-- é¡¶éƒ¨å¯¼èˆªæ  - å…­å¤§ç‰ˆå—æ¨ªå‘æ’åˆ— -->
        <div class="top-nav">
            <div class="logo-area">
                <span class="logo-icon">ğŸ¤¯</span>
                <span class="logo-text">æ ç²¾é©¾åˆ°</span>
            </div>
            <div class="nav-links">
                <span class="nav-link active" onclick="showPage('home')">é¦–é¡µ</span>
                <span class="nav-link" onclick="showPage('banter')">æŠ¬æ äº’èŠ</span>
                <span class="nav-link" onclick="showPage('diagnosis')">é€»è¾‘è¯Šæ–­</span>
                <span class="nav-link" onclick="showPage('fallacy')">è°¬è¯¯å¤§å…¨</span>
                <span class="nav-link" onclick="showPage('quiz')">æŠ¬æ é—¯å…³</span>
                <span class="nav-link" onclick="showPage('puzzle')">é€»è¾‘è°œé¢˜</span>
                <span class="nav-link" onclick="showPage('theater')">è°¬è¯¯å‰§åœº</span>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="content-area" id="contentArea">
            <!-- é¦–é¡µå†…å®¹ (é»˜è®¤æ˜¾ç¤º) -->
            <div id="homePage" class="home-content">
                <!-- ä¸ŠåŠéƒ¨åˆ† - åŸæœ‰é¦–é¡µå†…å®¹ -->
                <div class="hero-section">
                    <div class="pill-tag">AIé©±åŠ¨çš„é€»è¾‘æ€ç»´è®­ç»ƒå¹³å°</div>
                    <div class="hero-title">æ ç²¾é©¾åˆ°<br>é€»è¾‘å¤§å¸ˆ</div>
                    <div class="hero-sub">ç”¨AIçš„åŠ›é‡ï¼Œç£¨ç ºä½ çš„é€»è¾‘æ€ç»´ã€‚ä¸æ ç²¾å¯¹è¯ã€è¯Šæ–­é€»è¾‘æ¼æ´ã€è¯†ç ´è°¬è¯¯é™·é˜±<br>åœ¨è¾©è®ºçš„ä¸–ç•Œé‡Œï¼Œæˆä¸ºé‚£ä¸ªæ°¸è¿œæ— æ‡ˆå¯å‡»çš„äººã€‚</div>
                    <div class="cta-buttons">
                        <button class="cta-primary" onclick="showPage('banter')">å¼€å§‹æŠ¬æ â†’</button>
                        <button class="cta-secondary" onclick="showPage('diagnosis')">è¯Šæ–­é€»è¾‘&gt;</button>
                    </div>
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-value">30+</div>
                            <div class="stat-label">è°¬è¯¯ç±»å‹</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">AI</div>
                            <div class="stat-label">æ™ºèƒ½é©±åŠ¨</div>
                            <span class="stat-unit">100%</span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">âˆ</div>
                            <div class="stat-label">å¯¹è¯è½®æ¬¡</div>
                            <span class="stat-unit">é€»è¾‘ä¸¥è°¨</span>
                        </div>
                    </div>
                </div>

                <!-- ä¸‹æ–¹åŠŸèƒ½å¡ç‰‡ - æŠ¬æ é—¯å…³å’Œè°¬è¯¯å‰§åœº -->
                <div class="bottom-features">
                    <div class="feature-card" onclick="showPage('quiz')">
                        <span class="feature-icon">âš”ï¸</span>
                        <div class="feature-info">
                            <div class="feature-title">æŠ¬æ é—¯å…³</div>
                            <div class="feature-desc">50é“é€»è¾‘è°¬è¯¯é€‰æ‹©é¢˜ï¼ŒæŒ‘æˆ˜ä½ çš„è¯†åˆ«èƒ½åŠ›</div>
                        </div>
                        <span class="feature-badge">50é¢˜</span>
                    </div>
                    <div class="feature-card" onclick="showPage('theater')">
                        <span class="feature-icon">ğŸ­</span>
                        <div class="feature-info">
                            <div class="feature-title">è°¬è¯¯å‰§åœº</div>
                            <div class="feature-desc">è¾“å…¥ç”Ÿæ´»åœºæ™¯ï¼ŒAIåˆ†æå…¶ä¸­çš„é€»è¾‘è°¬è¯¯</div>
                        </div>
                        <span class="feature-badge">AIåˆ†æ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== é€»è¾‘å­¦å¤§å¸ˆå›å¤åº“ ==========
        const masterReplies = {
            banter: [
                "ã€é€»è¾‘åŸç†ã€‘æ ¹æ®å……è¶³ç†ç”±å¾‹ï¼Œä»»ä½•è®ºæ–­éƒ½éœ€è¦å……åˆ†ä¾æ®ã€‚æ‚¨åˆšæ‰çš„è§‚ç‚¹ç¼ºä¹æœ‰æ•ˆæ”¯æ’‘ï¼Œå»ºè®®è¡¥å……è¯æ®ã€‚",
                "ã€é€»è¾‘åŸç†ã€‘ä»åŒä¸€å¾‹çš„è§’åº¦çœ‹ï¼Œæ‚¨æ··æ·†äº†æ¦‚å¿µçš„å†…æ¶µã€‚è¯·æ˜ç¡®æ‚¨æ‰€ä½¿ç”¨çš„å®šä¹‰ï¼Œé¿å…å·æ¢æ¦‚å¿µã€‚",
                "ã€é€»è¾‘åŸç†ã€‘æ’ä¸­å¾‹æŒ‡å‡ºï¼Œä¸¤ä¸ªçŸ›ç›¾å‘½é¢˜å¿…æœ‰ä¸€çœŸã€‚æ‚¨ç›®å‰çš„è®ºè¿°é™·å…¥äº†æ¨¡æ£±ä¸¤å¯çš„å¢ƒåœ°ã€‚",
                "ã€é€»è¾‘åŸç†ã€‘è¿™é‡Œæ¶‰åŠå½’çº³æ¨ç†çš„å±€é™æ€§ã€‚æ‚¨ç”¨ä¸ªä¾‹æ¨å¯¼ä¸€èˆ¬ç»“è®ºï¼ŒçŠ¯äº†è½»ç‡å½’çº³çš„æ½œåœ¨é£é™©ã€‚",
                "ã€é€»è¾‘åŸç†ã€‘æ ¹æ®å‡è¨€æ¨ç†çš„è§„åˆ™ï¼Œè‚¯å®šåä»¶ä¸èƒ½è‚¯å®šå‰ä»¶ã€‚æ‚¨çš„æ¨ç†å½¢å¼æ— æ•ˆã€‚",
                "ã€é€»è¾‘åŸç†ã€‘ä»è®ºè¯ç»“æ„åˆ†æï¼Œæ‚¨ä½¿ç”¨äº†å¾ªç¯è®ºè¯â€”â€”ç»“è®ºå·²ç»æš—å«åœ¨å‰æä¸­ã€‚"
            ],
            diagnosis: [
                "ã€é€»è¾‘åŸç†ã€‘æ‚¨å¯èƒ½é™·å…¥äº†è¯‰è¯¸æƒå¨çš„è¯¯åŒºã€‚æƒå¨æ„è§åœ¨é€»è¾‘ä¸Šå¹¶ä¸è‡ªåŠ¨æ„æˆæœ‰æ•ˆè¯æ®ã€‚å»ºè®®ï¼šæä¾›è¯¥æƒå¨çš„å…·ä½“ç ”ç©¶æˆ–æ•°æ®ã€‚",
                "ã€é€»è¾‘åŸç†ã€‘è¿™æ˜¯å…¸å‹çš„è½»ç‡å½’çº³ã€‚ä»å°‘æ•°ä¸ªæ¡ˆæ¨å‡ºä¸€èˆ¬è§„å¾‹ï¼Œè¿åäº†å½’çº³æ¨ç†çš„å……è¶³æ ·æœ¬åŸåˆ™ã€‚å»ºè®®ï¼šå¯»æ‰¾åä¾‹ï¼Œæ‰©å¤§æ ·æœ¬èŒƒå›´ã€‚",
                "ã€é€»è¾‘åŸç†ã€‘æ‚¨çš„è¡¨è¿°å‘ˆç°å¾ªç¯è®ºè¯ç»“æ„ï¼šå‰æä¸­åŒ…å«äº†ç»“è®ºã€‚å»ºè®®ï¼šé‡æ–°æ¢³ç†è®ºè¯ï¼Œåˆ†å¼€å‰æä¸ç»“è®ºã€‚",
                "ã€é€»è¾‘åŸç†ã€‘è¿™é‡Œæ¶‰åŠéé»‘å³ç™½è°¬è¯¯ï¼Œæ’é™¤äº†ä¸­é—´é€‰é¡¹ã€‚é€»è¾‘ä¸Šå­˜åœ¨å¤šç§å¯èƒ½æ€§ã€‚å»ºè®®ï¼šè€ƒè™‘è¿ç»­è°±æˆ–æŠ˜ä¸­æ–¹æ¡ˆã€‚"
            ],
            theater: [
                {
                    keywords: ["å©†åª³", "å©†å©†", "åª³å¦‡", "å®¶åº­", "åµæ¶", "çŸ›ç›¾"],
                    response: "ã€å©†åª³çŸ›ç›¾é€»è¾‘åˆ†æã€‘\n\nå¸¸è§é€»è¾‘è°¬è¯¯ï¼š\n1. è¯‰è¯¸æƒ…æ„Ÿï¼šâ€œä½ ä¸å¬æˆ‘çš„å°±æ˜¯ä¸çˆ±æˆ‘â€ - ç”¨æƒ…æ„Ÿç»‘æ¶æ›¿ä»£ç†æ€§è®¨è®º\n2. éé»‘å³ç™½ï¼šâ€œè¦ä¹ˆå¬æˆ‘çš„ï¼Œè¦ä¹ˆå°±åˆ«è¿‡äº†â€ - å¿½ç•¥ä¸­é—´é€‰é¡¹\n3. è½»ç‡å½’çº³ï¼šâ€œä½ æ¯æ¬¡éƒ½è¿™æ ·â€ - ä»¥åæ¦‚å…¨\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ åŒºåˆ†äº‹å®ä¸æ„Ÿå—ï¼Œå°±äº‹è®ºäº‹\nâ€¢ å¯»æ‰¾å…±åŒç›®æ ‡ï¼Œé¿å…æç«¯å¯¹ç«‹\nâ€¢ ç”¨â€œæˆ‘æ„Ÿè§‰åˆ°â€¦â€ä»£æ›¿â€œä½ æ€»æ˜¯â€¦â€"
                },
                {
                    keywords: ["èŒåœº", "å·¥ä½œ", "åŒäº‹", "è€æ¿", "é¢†å¯¼", "åŠ ç­"],
                    response: "ã€èŒåœºè¾©è®ºé€»è¾‘åˆ†æã€‘\n\nå¸¸è§é€»è¾‘è°¬è¯¯ï¼š\n1. è¯‰è¯¸å¤§ä¼—ï¼šâ€œåˆ«äººéƒ½åŠ ç­ï¼Œä½ ä¹Ÿåº”è¯¥åŠ â€ - ä»ä¼—è°¬è¯¯\n2. äººèº«æ”»å‡»ï¼šâ€œä¸åŠ ç­å°±æ˜¯ä¸åŠªåŠ›â€ - æ”»å‡»äººæ ¼è€Œéè®ºç‚¹\n3. è™šå‡ä¸¤éš¾ï¼šâ€œè¦ä¹ˆåŠ ç­ï¼Œè¦ä¹ˆèµ°äººâ€ - å¿½ç•¥å¼¹æ€§å·¥ä½œç­‰å¯èƒ½\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ ç”¨æ•°æ®è¯´è¯ï¼Œé¿å…æƒ…ç»ªåŒ–\nâ€¢ åŒºåˆ†å·¥ä½œèƒ½åŠ›ä¸åŠ ç­æ—¶é•¿\nâ€¢ æå‡ºå»ºè®¾æ€§æ›¿ä»£æ–¹æ¡ˆ"
                },
                {
                    keywords: ["ç½‘ç»œ", "äº’å–·", "é”®ç›˜ä¾ ", "ç½‘å‹", "åµæ¶"],
                    response: "ã€ç½‘ç»œäº’å–·é€»è¾‘åˆ†æã€‘\n\nå¸¸è§é€»è¾‘è°¬è¯¯ï¼š\n1. ç¨»è‰äººè°¬è¯¯ï¼šæ­ªæ›²å¯¹æ–¹è§‚ç‚¹å†æ”»å‡»\n2. äººèº«æ”»å‡»ï¼šâ€œä½ è¡Œä½ ä¸Šå•Šâ€ - è½¬ç§»è¯é¢˜åˆ°ä¸ªäººèƒ½åŠ›\n3. çº¢é²±é±¼ï¼šå¼•å…¥æ— å…³è¯é¢˜è½¬ç§»ç„¦ç‚¹\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ å…ˆå¤è¿°å¯¹æ–¹è§‚ç‚¹ç¡®è®¤ç†è§£\nâ€¢ é’ˆå¯¹è®ºç‚¹è€Œéä¸ªäºº\nâ€¢ å¿½ç•¥æŒ‘è¡…ï¼Œèšç„¦æ ¸å¿ƒåˆ†æ­§"
                },
                {
                    keywords: ["æƒ…ä¾£", "æ‹çˆ±", "ç”·å¥³æœ‹å‹", "å¯¹è±¡", "åˆ†æ‰‹"],
                    response: "ã€æƒ…ä¾£äº‰åµé€»è¾‘åˆ†æã€‘\n\nå¸¸è§é€»è¾‘è°¬è¯¯ï¼š\n1. è¯‰è¯¸æƒ…æ„Ÿï¼šâ€œä½ è¿™æ ·åšå°±æ˜¯ä¸çˆ±æˆ‘â€ - æƒ…æ„Ÿç»‘æ¶\n2. æ»‘å¡è°¬è¯¯ï¼šâ€œè¿™æ¬¡åŸè°…ï¼Œä¸‹æ¬¡ä¼šæ›´è¿‡åˆ†â€ - å¤¸å¤§åæœ\n3. å¾ªç¯è®ºè¯ï¼šâ€œå› ä¸ºä¸çˆ±æ‰€ä»¥æ‰è¿™æ ·â€ - ç”¨ç»“è®ºè¯æ˜å‰æ\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ è¡¨è¾¾æ„Ÿå—è€ŒéæŒ‡è´£\nâ€¢ å°±äº‹è®ºäº‹ï¼Œä¸ç¿»æ—§è´¦\nâ€¢ å¯»æ‰¾å…·ä½“è§£å†³æ–¹æ¡ˆè€Œéå®šæ€§"
                },
                {
                    keywords: ["äº²å­", "çˆ¶æ¯", "å­©å­", "æ•™è‚²", "å®¶é•¿"],
                    response: "ã€äº²å­æ•™è‚²é€»è¾‘åˆ†æã€‘\n\nå¸¸è§é€»è¾‘è°¬è¯¯ï¼š\n1. è¯‰è¯¸æƒå¨ï¼šâ€œæˆ‘æ˜¯ä½ çˆ¸ï¼Œå¬æˆ‘çš„â€ - ç”¨èº«ä»½å‹åˆ¶æ›¿ä»£è¯´ç†\n2. é”™è¯¯å› æœï¼šâ€œä¸å¬è¯å°±ä¼šå˜åâ€ - ç¼ºä¹å› æœè¯æ®\n3. éé»‘å³ç™½ï¼šâ€œè¦ä¹ˆå­¦ä¹ ï¼Œè¦ä¹ˆç©â€ - å¿½ç•¥å¹³è¡¡å¯èƒ½\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ è§£é‡Šè§„åˆ™èƒŒåçš„åŸå› \nâ€¢ ç»™äºˆé€‰æ‹©æƒåŸ¹å…»è‡ªä¸»æ€§\nâ€¢ ç”¨é¼“åŠ±ä»£æ›¿å¨èƒ"
                }
            ]
        };

        // ========== è°¬è¯¯å¤§å…¨çŸ¥è¯†åº“ ==========
        const fallacyDatabase = [
            { keywords: ["æ»‘å¡", "æ»‘å¡è°¬è¯¯"], response: "ã€æ»‘å¡è°¬è¯¯ã€‘é€»è¾‘åŸç†ï¼šæ–­è¨€Aå‘ç”Ÿå¿…ç„¶å¯¼è‡´Zï¼Œä½†ç¼ºä¹ä¸­é—´ç¯èŠ‚çš„å› æœè¯æ®ã€‚ç ´è§£æ–¹æ³•ï¼šæŒ‡å‡ºæ¯ä¸€æ­¥éƒ½éœ€è¦ç‹¬ç«‹è¯æ˜ï¼Œå¹¶å¯»æ‰¾ä¸­æ­¢å› ç´ ã€‚" },
            { keywords: ["ç¨»è‰äºº", "ç¨»è‰äººè°¬è¯¯"], response: "ã€ç¨»è‰äººè°¬è¯¯ã€‘é€»è¾‘åŸç†ï¼šæ­ªæ›²æˆ–å¤¸å¤§å¯¹æ–¹è®ºç‚¹ï¼Œç„¶åæ”»å‡»è¿™ä¸ªè¢«æ­ªæ›²çš„è§‚ç‚¹ã€‚ç ´è§£æ–¹æ³•ï¼šå‡†ç¡®å¤è¿°å¯¹æ–¹åŸæ„ï¼Œåªé’ˆå¯¹çœŸå®è®ºç‚¹è¾©è®ºã€‚" },
            { keywords: ["è¯‰è¯¸æƒå¨", "æƒå¨"], response: "ã€è¯‰è¯¸æƒå¨ã€‘é€»è¾‘åŸç†ï¼šå°†æƒå¨è¨€è®ºå½“ä½œç»å¯¹ä¾æ®ï¼Œå¿½ç•¥è®ºè¯æœ¬èº«ã€‚ç ´è§£æ–¹æ³•ï¼šè¦æ±‚æä¾›æƒå¨çš„å…·ä½“è®ºæ®ï¼Œè€Œéä»…ä¾é å¤´è¡”ã€‚" },
            { keywords: ["è½»ç‡å½’çº³", "ä»¥åæ¦‚å…¨"], response: "ã€è½»ç‡å½’çº³ã€‘é€»è¾‘åŸç†ï¼šæ ·æœ¬è¿‡å°æˆ–ç‰¹æ®Šï¼Œä¸è¶³ä»¥æ¦‚æ‹¬æ•´ä½“ã€‚ç ´è§£æ–¹æ³•ï¼šæŒ‡å‡ºåä¾‹å­˜åœ¨ï¼Œè¦æ±‚æ›´å¤§æ ·æœ¬ã€‚" },
            { keywords: ["éé»‘å³ç™½", "äºŒåˆ†æ³•"], response: "ã€éé»‘å³ç™½ã€‘é€»è¾‘åŸç†ï¼šé”™è¯¯åœ°è®¤ä¸ºåªæœ‰ä¸¤ç§æç«¯é€‰é¡¹ã€‚ç ´è§£æ–¹æ³•ï¼šæå‡ºä¸­é—´é€‰é¡¹ï¼Œæ‰“ç ´äºŒåˆ†æ³•ã€‚" },
            { keywords: ["äººèº«æ”»å‡»", "äººèº«"], response: "ã€äººèº«æ”»å‡»ã€‘é€»è¾‘åŸç†ï¼šæ”»å‡»å¯¹æ–¹äººæ ¼è€Œéè®ºç‚¹ã€‚ç ´è§£æ–¹æ³•ï¼šå¿½ç•¥äººèº«æ”»å‡»ï¼Œå›å½’è®ºç‚¹è®¨è®ºã€‚" }
        ];

        // ========== é¢˜åº“ ==========
        const baseQuiz = [
            { question: "â€œå¦‚æœä¸å…è®¸å­¦ç”Ÿè°ˆæ‹çˆ±ï¼Œå­¦æ ¡å°±ä¼šå˜æˆä¿®é“é™¢ï¼Œæœ€åå­¦ç”Ÿéƒ½ä¼šé€€å­¦ã€‚â€è¿™æ®µè®ºè¿°çŠ¯äº†ä»€ä¹ˆè°¬è¯¯ï¼Ÿ", options: ["æ»‘å¡è°¬è¯¯", "ç¨»è‰äººè°¬è¯¯", "è¯‰è¯¸æƒå¨", "è½»ç‡å½’çº³"], correct: 0, explanation: "æ»‘å¡è°¬è¯¯ï¼šæ–­è¨€Aå‘ç”Ÿä¼šå¯¼è‡´ä¸€ç³»åˆ—è¿é”ååº”ï¼Œä½†ç¼ºä¹æ¯ä¸€æ­¥çš„å¿…ç„¶æ€§è¯æ®ã€‚" },
            { question: "â€œä½ è¿è¿™ä¸ªéƒ½ä¸æ‡‚ï¼Œç®€ç›´å°±æ˜¯æ–‡ç›²ï¼æ‰€ä»¥ä½ çš„è§‚ç‚¹å®Œå…¨ä¸å€¼å¾—è€ƒè™‘ã€‚â€è¿™æ˜¯ä»€ä¹ˆè°¬è¯¯ï¼Ÿ", options: ["äººèº«æ”»å‡»", "è¯‰è¯¸æƒ…æ„Ÿ", "éé»‘å³ç™½", "å¾ªç¯è®ºè¯"], correct: 0, explanation: "äººèº«æ”»å‡»ï¼šæ”»å‡»å¯¹æ–¹äººæ ¼è€Œéè®ºç‚¹ã€‚" },
            { question: "â€œè‘—åç‰©ç†å­¦å®¶éœé‡‘éƒ½ç›¸ä¿¡å¤–æ˜Ÿäººå­˜åœ¨ï¼Œæ‰€ä»¥å¤–æ˜Ÿäººä¸€å®šå­˜åœ¨ã€‚â€è¿™å¥è¯çš„è°¬è¯¯æ˜¯ï¼Ÿ", options: ["è¯‰è¯¸æƒå¨", "è™šå‡å› æœ", "æ»‘å¡è°¬è¯¯", "ç¨»è‰äºº"], correct: 0, explanation: "è¯‰è¯¸æƒå¨ï¼šæƒå¨çš„æ„è§ä¸èƒ½ç›´æ¥ä½œä¸ºæœ€ç»ˆè¯æ®ï¼Œéœ€ç»“åˆç§‘å­¦è®ºè¯ã€‚" },
            { question: "â€œæˆ‘è®¤è¯†çš„ä¸‰ä¸ªä¸œåŒ—äººéƒ½è±ªçˆ½ï¼Œæ‰€ä»¥æ‰€æœ‰ä¸œåŒ—äººéƒ½è±ªçˆ½ã€‚â€è¿™çŠ¯äº†ä»€ä¹ˆè°¬è¯¯ï¼Ÿ", options: ["è½»ç‡å½’çº³", "ä¸å½“ç±»æ¯”", "ä»¥åæ¦‚å…¨", "äºŒè€…éƒ½æ˜¯"], correct: 3, explanation: "è½»ç‡å½’çº³/ä»¥åæ¦‚å…¨ï¼šæ ·æœ¬è¿‡å°ï¼Œä¸è¶³ä»¥æ¦‚æ‹¬æ•´ä½“ã€‚" },
            { question: "â€œä½ è¦ä¹ˆæ”¯æŒæˆ‘çš„è®¡åˆ’ï¼Œè¦ä¹ˆå°±æ˜¯åå¯¹å…¬å¸å‘å±•ã€‚â€è¿™ç§è¯´æ³•å±äºï¼Ÿ", options: ["éé»‘å³ç™½", "æ»‘å¡è°¬è¯¯", "è¯‰è¯¸ä¼ ç»Ÿ", "äººèº«æ”»å‡»"], correct: 0, explanation: "éé»‘å³ç™½ï¼šé”™è¯¯åœ°è®¤ä¸ºåªæœ‰ä¸¤ç§æç«¯é€‰é¡¹ï¼Œå¿½ç•¥äº†ä¸­é—´ç«‹åœºã€‚" }
        ];

        // ç”Ÿæˆ50é¢˜
        const quizBank = [];
        for (let i = 0; i < 50; i++) {
            const baseIndex = i % baseQuiz.length;
            const q = { ...baseQuiz[baseIndex] };
            if (i >= baseQuiz.length) {
                q.question = q.question.replace("ï¼Ÿ", "ï¼Ÿ(å˜ä½“" + (Math.floor(i/baseQuiz.length)+1) + ")");
            }
            quizBank.push(q);
        }

        // è°œé¢˜10é¢˜
        const puzzleBank = baseQuiz.slice(0, 10);

        // çŠ¶æ€å˜é‡
        let currentQuizQuestions = [];
        let currentQuizIndex = 0;
        let quizScore = 0;
        let quizAnswers = [];

        let currentPuzzleQuestions = [];
        let currentPuzzleIndex = 0;
        let puzzleScore = 0;
        let puzzleAnswers = [];

        const contentArea = document.getElementById('contentArea');

        // ========== é¡µé¢ç®¡ç† ==========
        function showPage(page) {
            // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.textContent.includes('é¦–é¡µ') && page === 'home') link.classList.add('active');
                if (link.textContent.includes('æŠ¬æ äº’èŠ') && page === 'banter') link.classList.add('active');
                if (link.textContent.includes('é€»è¾‘è¯Šæ–­') && page === 'diagnosis') link.classList.add('active');
                if (link.textContent.includes('è°¬è¯¯å¤§å…¨') && page === 'fallacy') link.classList.add('active');
                if (link.textContent.includes('æŠ¬æ é—¯å…³') && page === 'quiz') link.classList.add('active');
                if (link.textContent.includes('é€»è¾‘è°œé¢˜') && page === 'puzzle') link.classList.add('active');
                if (link.textContent.includes('è°¬è¯¯å‰§åœº') && page === 'theater') link.classList.add('active');
            });

            if (page === 'home') {
                document.getElementById('homePage').style.display = 'block';
                const subpage = document.querySelector('.subpage');
                if (subpage) subpage.remove();
                return;
            }

            document.getElementById('homePage').style.display = 'none';
            const existingSubpage = document.querySelector('.subpage');
            if (existingSubpage) existingSubpage.remove();

            const subpageDiv = document.createElement('div');
            subpageDiv.className = 'subpage';
            
            if (page === 'banter') {
                subpageDiv.innerHTML = getBanterPageHTML();
                contentArea.appendChild(subpageDiv);
                initBanterPage();
            } else if (page === 'diagnosis') {
                subpageDiv.innerHTML = getDiagnosisPageHTML();
                contentArea.appendChild(subpageDiv);
                initDiagnosisPage();
            } else if (page === 'fallacy') {
                subpageDiv.innerHTML = getFallacyPageHTML();
                contentArea.appendChild(subpageDiv);
                initFallacyPage();
            } else if (page === 'quiz') {
                subpageDiv.innerHTML = getQuizPageHTML();
                contentArea.appendChild(subpageDiv);
                initQuizPage();
            } else if (page === 'puzzle') {
                subpageDiv.innerHTML = getPuzzlePageHTML();
                contentArea.appendChild(subpageDiv);
                initPuzzlePage();
            } else if (page === 'theater') {
                subpageDiv.innerHTML = getTheaterPageHTML();
                contentArea.appendChild(subpageDiv);
                initTheaterPage();
            }
        }

        // é¡µé¢HTMLç”Ÿæˆå‡½æ•°
        function getBanterPageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">æŠ¬æ äº’èŠ</span>
                </div>
                <div class="chat-container">
                    <div class="chat-history" id="banterHistory">
                        <div class="message">
                            <span class="msg-avatar">ğŸ“</span>
                            <span class="msg-bubble">ã€é€»è¾‘åŸç†ã€‘æ¬¢è¿æé—®ï¼Œæˆ‘å°†ä»é€»è¾‘å­¦è§’åº¦åˆ†æã€‚</span>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="banterInput" placeholder="è¾“å…¥ä½ çš„è§‚ç‚¹...">
                        <button class="send-btn" id="sendBanterBtn">å‘é€</button>
                    </div>
                </div>
            `;
        }

        function getDiagnosisPageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">é€»è¾‘è¯Šæ–­</span>
                </div>
                <div class="diagnosis-container">
                    <textarea class="diagnosis-input" id="diagnosisInput" placeholder="æè¿°ä½ çš„é€»è¾‘å›°å¢ƒ..."></textarea>
                    <button class="quiz-btn" id="diagnoseBtn" style="width:100%;">å¼€å§‹è¯Šæ–­</button>
                    <div class="diagnosis-result" id="diagnosisResult">
                        ç­‰å¾…æ‚¨è¾“å…¥é—®é¢˜...
                    </div>
                </div>
            `;
        }

        function getFallacyPageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">è°¬è¯¯å¤§å…¨</span>
                </div>
                <div class="chat-container">
                    <div class="chat-history" id="fallacyHistory">
                        <div class="message">
                            <span class="msg-avatar">ğŸ“š</span>
                            <span class="msg-bubble">è¯·é—®ä½ æƒ³äº†è§£å“ªç§é€»è¾‘è°¬è¯¯ï¼Ÿä¾‹å¦‚ï¼šæ»‘å¡è°¬è¯¯ã€ç¨»è‰äººã€è¯‰è¯¸æƒå¨ç­‰ã€‚</span>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="fallacyInput" placeholder="è¾“å…¥è°¬è¯¯åç§°...">
                        <button class="send-btn" id="sendFallacyBtn">æŸ¥è¯¢</button>
                    </div>
                </div>
            `;
        }

        function getTheaterPageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">è°¬è¯¯å‰§åœº</span>
                </div>
                <div class="chat-container">
                    <div class="chat-history" id="theaterHistory">
                        <div class="message">
                            <span class="msg-avatar">ğŸ­</span>
                            <span class="msg-bubble">è¯·è¾“å…¥ä½ æƒ³è¦åˆ†æçš„ç”Ÿæ´»åœºæ™¯ï¼Œä¾‹å¦‚ï¼šå©†åª³çŸ›ç›¾ã€èŒåœºåŠ ç­ã€ç½‘ç»œäº’å–·ã€æƒ…ä¾£åµæ¶ç­‰ã€‚</span>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="theaterInput" placeholder="ä¾‹å¦‚ï¼šå©†åª³çŸ›ç›¾">
                        <button class="send-btn" id="sendTheaterBtn">åˆ†æ</button>
                    </div>
                </div>
            `;
        }

        function getQuizPageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">æŠ¬æ é—¯å…³ Â· 50é¢˜</span>
                </div>
                <div class="quiz-container" id="quizContainer">
                    <!-- åŠ¨æ€æ¸²æŸ“ -->
                </div>
            `;
        }

        function getPuzzlePageHTML() {
            return `
                <div class="subpage-header">
                    <button class="back-btn" onclick="showPage('home')">â† è¿”å›é¦–é¡µ</button>
                    <span class="subpage-title">é€»è¾‘è°œé¢˜ Â· 10é¢˜</span>
                </div>
                <div class="quiz-container" id="puzzleContainer">
                    <!-- åŠ¨æ€æ¸²æŸ“ -->
                </div>
            `;
        }

        // ========== åˆå§‹åŒ–å‡½æ•° ==========
        function initBanterPage() {
            const input = document.getElementById('banterInput');
            const sendBtn = document.getElementById('sendBanterBtn');
            const history = document.getElementById('banterHistory');

            sendBtn.addEventListener('click', () => {
                const text = input.value.trim();
                if (!text) return;
                addMessage(history, 'user', text);
                const reply = masterReplies.banter[Math.floor(Math.random() * masterReplies.banter.length)];
                addMessage(history, 'bot', reply, 'ğŸ“');
                input.value = '';
            });

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendBtn.click();
            });
        }

        function initDiagnosisPage() {
            const input = document.getElementById('diagnosisInput');
            const btn = document.getElementById('diagnoseBtn');
            const result = document.getElementById('diagnosisResult');

            btn.addEventListener('click', () => {
                const text = input.value.trim();
                if (!text) return;
                const reply = masterReplies.diagnosis[Math.floor(Math.random() * masterReplies.diagnosis.length)];
                result.innerHTML = reply;
            });
        }

        function initFallacyPage() {
            const input = document.getElementById('fallacyInput');
            const sendBtn = document.getElementById('sendFallacyBtn');
            const history = document.getElementById('fallacyHistory');

            function findFallacyResponse(query) {
                if (!query) return "è¯·è¾“å…¥ä½ è¦æŸ¥è¯¢çš„è°¬è¯¯åç§°ã€‚";
                const lowerQuery = query.toLowerCase();
                for (let item of fallacyDatabase) {
                    for (let kw of item.keywords) {
                        if (lowerQuery.includes(kw.toLowerCase())) {
                            return item.response;
                        }
                    }
                }
                return "æœªæ‰¾åˆ°è¯¥è°¬è¯¯ï¼Œè¯·å°è¯•è¾“å…¥ï¼šæ»‘å¡è°¬è¯¯ã€ç¨»è‰äººã€è¯‰è¯¸æƒå¨ç­‰ã€‚";
            }

            sendBtn.addEventListener('click', () => {
                const text = input.value.trim();
                if (!text) return;
                addMessage(history, 'user', text);
                const reply = findFallacyResponse(text);
                addMessage(history, 'bot', reply, 'ğŸ“š');
                input.value = '';
            });

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendBtn.click();
            });
        }

        function initTheaterPage() {
            const input = document.getElementById('theaterInput');
            const sendBtn = document.getElementById('sendTheaterBtn');
            const history = document.getElementById('theaterHistory');

            function findTheaterResponse(query) {
                if (!query) return "è¯·è¾“å…¥ä½ è¦åˆ†æçš„ç”Ÿæ´»åœºæ™¯ã€‚";
                const lowerQuery = query.toLowerCase();
                
                for (let item of masterReplies.theater) {
                    for (let kw of item.keywords) {
                        if (lowerQuery.includes(kw.toLowerCase())) {
                            return item.response;
                        }
                    }
                }
                
                return "ã€åœºæ™¯åˆ†æã€‘\n\næ ¹æ®æ‚¨æè¿°çš„åœºæ™¯ï¼Œå¸¸è§é€»è¾‘è°¬è¯¯å¯èƒ½åŒ…æ‹¬ï¼š\n1. è¯‰è¯¸æƒ…æ„Ÿ - ç”¨æƒ…æ„Ÿä»£æ›¿ç†æ€§è®¨è®º\n2. éé»‘å³ç™½ - å¿½ç•¥ä¸­é—´é€‰é¡¹\n3. äººèº«æ”»å‡» - é’ˆå¯¹ä¸ªäººè€Œéè®ºç‚¹\n\nçº æ­£å»ºè®®ï¼š\nâ€¢ å…ˆå†·é™ä¸‹æ¥ï¼ŒåŒºåˆ†äº‹å®å’Œæ„Ÿå—\nâ€¢ ç”¨â€œæˆ‘â€å¥å¼è¡¨è¾¾éœ€æ±‚\nâ€¢ å¯»æ‰¾å…±åŒç›®æ ‡è€Œéäº’ç›¸æŒ‡è´£";
            }

            sendBtn.addEventListener('click', () => {
                const text = input.value.trim();
                if (!text) return;
                addMessage(history, 'user', text);
                const reply = findTheaterResponse(text);
                addMessage(history, 'bot', reply, 'ğŸ­');
                input.value = '';
            });

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendBtn.click();
            });
        }

        function addMessage(history, sender, text, avatar = 'ğŸ§‘') {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            const userAvatar = sender === 'user' ? 'ğŸ§‘' : avatar;
            msgDiv.innerHTML = `
                <span class="msg-avatar">${userAvatar}</span>
                <span class="msg-bubble">${text}</span>
            `;
            history.appendChild(msgDiv);
            history.scrollTop = history.scrollHeight;
        }

        // æŠ¬æ é—¯å…³
        function initQuizPage() {
            startNewQuiz();
        }

        function startNewQuiz() {
            const shuffled = [...quizBank].sort(() => Math.random() - 0.5);
            currentQuizQuestions = shuffled.slice(0, 50);
            currentQuizIndex = 0;
            quizScore = 0;
            quizAnswers = new Array(50).fill(undefined);
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const container = document.getElementById('quizContainer');
            if (!container || currentQuizIndex >= currentQuizQuestions.length) {
                if (container) showQuizResult();
                return;
            }

            const q = currentQuizQuestions[currentQuizIndex];
            const isAnswered = quizAnswers[currentQuizIndex] !== undefined;
            const selectedIdx = quizAnswers[currentQuizIndex];

            let optionsHtml = '';
            q.options.forEach((opt, idx) => {
                let selectedClass = (selectedIdx === idx) ? 'selected' : '';
                optionsHtml += `
                    <div class="option-item ${selectedClass}" data-opt-index="${idx}">
                        <span style="margin-right:12px; color:#fcb26b;">${String.fromCharCode(65 + idx)}</span>
                        <span>${opt}</span>
                    </div>
                `;
            });

            let feedbackHtml = '';
            if (isAnswered) {
                const isCorrect = (selectedIdx === q.correct);
                feedbackHtml = `
                    <div style="margin-top:16px; padding:12px; background:#1a1f2b; border-radius:16px; border-left:6px solid ${isCorrect ? '#4caf50' : '#f44336'};">
                        <strong style="color:${isCorrect ? '#a5d6a5' : '#ffb3b3'};">${isCorrect ? 'âœ… æ­£ç¡®ï¼' : 'âŒ é”™è¯¯ï¼'}</strong><br>
                        <span style="color:#b1c7e0;">${q.explanation}</span>
                    </div>
                `;
            }

            let nextButton = '';
            if (isAnswered) {
                if (currentQuizIndex === 49) {
                    nextButton = `<button class="quiz-btn" id="finishQuizBtn">æŸ¥çœ‹åˆ†æ•°</button>`;
                } else {
                    nextButton = `<button class="quiz-btn" id="nextQuizBtn">ä¸‹ä¸€é¢˜</button>`;
                }
            } else {
                nextButton = `<button class="quiz-btn" id="submitQuizBtn" disabled style="opacity:0.5;">è¯·å…ˆé€‰æ‹©ç­”æ¡ˆ</button>`;
            }

            const html = `
                <div class="quiz-header">
                    <span>ç¬¬ ${currentQuizIndex + 1} / 50 é¢˜</span>
                    <span class="score-badge">å¾—åˆ†: ${quizScore}</span>
                </div>
                <div class="question-text">${q.question}</div>
                <div class="options-grid" id="quizOptions">
                    ${optionsHtml}
                </div>
                <div class="quiz-footer" style="display:flex; gap:10px;">
                    ${nextButton}
                    <button class="quiz-btn secondary" id="resetQuizBtn">é‡æ¥</button>
                </div>
                ${feedbackHtml}
            `;

            container.innerHTML = html;
            bindQuizEvents(q);
        }

        function bindQuizEvents(q) {
            if (quizAnswers[currentQuizIndex] === undefined) {
                document.querySelectorAll('.option-item').forEach(el => {
                    el.addEventListener('click', function() {
                        document.querySelectorAll('.option-item').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        document.getElementById('submitQuizBtn').disabled = false;
                        document.getElementById('submitQuizBtn').style.opacity = '1';
                    });
                });
            }

            document.getElementById('submitQuizBtn')?.addEventListener('click', () => {
                const selected = document.querySelector('.option-item.selected');
                if (!selected) return;
                const answerIdx = parseInt(selected.dataset.optIndex);
                quizAnswers[currentQuizIndex] = answerIdx;
                if (answerIdx === q.correct) quizScore++;
                renderQuizQuestion();
            });

            document.getElementById('nextQuizBtn')?.addEventListener('click', () => {
                currentQuizIndex++;
                renderQuizQuestion();
            });

            document.getElementById('finishQuizBtn')?.addEventListener('click', showQuizResult);
            document.getElementById('resetQuizBtn')?.addEventListener('click', startNewQuiz);
        }

        function showQuizResult() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = `
                <div class="quiz-header">
                    <span>é—¯å…³å®Œæˆï¼</span>
                    <span class="score-badge">${quizScore} / 50</span>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="quiz-btn" onclick="startNewQuiz()">å†æ¬¡æŒ‘æˆ˜</button>
                </div>
            `;
        }

        // é€»è¾‘è°œé¢˜
        function initPuzzlePage() {
            startNewPuzzle();
        }

        function startNewPuzzle() {
            const shuffled = [...puzzleBank].sort(() => Math.random() - 0.5);
            currentPuzzleQuestions = shuffled.slice(0, 10);
            currentPuzzleIndex = 0;
            puzzleScore = 0;
            puzzleAnswers = new Array(10).fill(undefined);
            renderPuzzleQuestion();
        }

        function renderPuzzleQuestion() {
            const container = document.getElementById('puzzleContainer');
            if (!container || currentPuzzleIndex >= currentPuzzleQuestions.length) {
                if (container) showPuzzleResult();
                return;
            }

            const q = currentPuzzleQuestions[currentPuzzleIndex];
            const isAnswered = puzzleAnswers[currentPuzzleIndex] !== undefined;
            const selectedIdx = puzzleAnswers[currentPuzzleIndex];

            let optionsHtml = '';
            q.options.forEach((opt, idx) => {
                let selectedClass = (selectedIdx === idx) ? 'selected' : '';
                optionsHtml += `
                    <div class="option-item ${selectedClass}" data-opt-index="${idx}">
                        <span style="margin-right:12px; color:#fcb26b;">${String.fromCharCode(65 + idx)}</span>
                        <span>${opt}</span>
                    </div>
                `;
            });

            let nextButton = '';
            if (isAnswered) {
                if (currentPuzzleIndex === 9) {
                    nextButton = `<button class="quiz-btn" id="finishPuzzleBtn">æŸ¥çœ‹åˆ†æ•°</button>`;
                } else {
                    nextButton = `<button class="quiz-btn" id="nextPuzzleBtn">ä¸‹ä¸€é¢˜</button>`;
                }
            } else {
                nextButton = `<button class="quiz-btn" id="submitPuzzleBtn" disabled style="opacity:0.5;">è¯·å…ˆé€‰æ‹©ç­”æ¡ˆ</button>`;
            }

            const html = `
                <div class="quiz-header">
                    <span>ç¬¬ ${currentPuzzleIndex + 1} / 10 é¢˜</span>
                    <span class="score-badge">å¾—åˆ†: ${puzzleScore}</span>
                </div>
                <div class="question-text">${q.question}</div>
                <div class="options-grid" id="puzzleOptions">
                    ${optionsHtml}
                </div>
                <div class="quiz-footer" style="display:flex; gap:10px;">
                    ${nextButton}
                    <button class="quiz-btn secondary" id="resetPuzzleBtn">é‡æ¥</button>
                </div>
            `;

            container.innerHTML = html;
            bindPuzzleEvents(q);
        }

        function bindPuzzleEvents(q) {
            if (puzzleAnswers[currentPuzzleIndex] === undefined) {
                document.querySelectorAll('.option-item').forEach(el => {
                    el.addEventListener('click', function() {
                        document.querySelectorAll('.option-item').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        document.getElementById('submitPuzzleBtn').disabled = false;
                        document.getElementById('submitPuzzleBtn').style.opacity = '1';
                    });
                });
            }

            document.getElementById('submitPuzzleBtn')?.addEventListener('click', () => {
                const selected = document.querySelector('.option-item.selected');
                if (!selected) return;
                const answerIdx = parseInt(selected.dataset.optIndex);
                puzzleAnswers[currentPuzzleIndex] = answerIdx;
                if (answerIdx === q.correct) puzzleScore++;
                renderPuzzleQuestion();
            });

            document.getElementById('nextPuzzleBtn')?.addEventListener('click', () => {
                currentPuzzleIndex++;
                renderPuzzleQuestion();
            });

            document.getElementById('finishPuzzleBtn')?.addEventListener('click', showPuzzleResult);
            document.getElementById('resetPuzzleBtn')?.addEventListener('click', startNewPuzzle);
        }

        function showPuzzleResult() {
            const container = document.getElementById('puzzleContainer');
            container.innerHTML = `
                <div class="quiz-header">
                    <span>é—¯å…³å®Œæˆï¼</span>
                    <span class="score-badge">${puzzleScore} / 10</span>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="quiz-btn" onclick="startNewPuzzle()">å†æ¬¡æŒ‘æˆ˜</button>
                </div>
            `;
        }

        // å…¨å±€å‡½æ•°
        window.showPage = showPage;
        window.startNewQuiz = startNewQuiz;
        window.startNewPuzzle = startNewPuzzle;
    </script>
</body>
</html>